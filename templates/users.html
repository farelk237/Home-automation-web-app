<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Utilisateurs</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
</head>
<body>
    <div class="container my-5">
        <h1 class="text-center mb-4">Gestion des Utilisateurs</h1>
        <div class="d-flex justify-content-center gap-3 mb-4">
            <!-- Bouton pour afficher les utilisateurs -->
            <button class="btn btn-primary" id="showUsersBtn">Voir les utilisateurs</button>
            <!-- Bouton pour afficher les connexions -->
            <button class="btn btn-secondary" id="showConnectionsBtn">Voir les connexions</button>
        </div>
        <div id="contentSection">
            <!-- Contenu dynamique chargé ici -->
        </div>
    </div>

    <script>
        
        const token = localStorage.getItem('token'); // Supposons que vous stockez le token dans localStorage

        fetch('/users', {
            method: 'GET',
            headers: {
             'Authorization': `Bearer ${token}`
            }
        })
        .then(response => response.json())
        .then(data => {
            console.log('Utilisateurs:', data);
            // Ajoutez ici le code pour afficher les utilisateurs dans la page
        })
        .catch(error => console.error('Erreur:', error));

        fetch('/connections', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
        .then(response => response.json())
        .then(data => {
            console.log('Connexions:', data);
            // Ajoutez ici le code pour afficher les connexions dans la page
        })
        .catch(error => console.error('Erreur:', error));

        // Fonction pour afficher les utilisateurs
        async function fetchUsers() {
            try {
                const response = await axios.get('/users');
                const users = response.data.users;

                let htmlContent = `
                    <h2 class="text-center mb-3">Liste des utilisateurs</h2>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Email</th>
                                <th>Dernière connexion</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                users.forEach((user, index) => {
                    htmlContent += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${user.email}</td>
                            <td>${user.last_login || 'Non disponible'}</td>
                        </tr>
                    `;
                });
                htmlContent += '</tbody></table>';
                document.getElementById('contentSection').innerHTML = htmlContent;
            } catch (error) {
                console.error(error);
                document.getElementById('contentSection').innerHTML = `
                    <div class="alert alert-danger">Erreur lors de la récupération des utilisateurs.</div>
                `;
            }
        }

        // Fonction pour afficher les connexions
        async function fetchConnections() {
            try {
                const response = await axios.get('/connections');
                const connections = response.data.connections;

                let htmlContent = `
                    <h2 class="text-center mb-3">Historique des connexions</h2>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Utilisateur</th>
                                <th>Adresse IP</th>
                                <th>Date et Heure</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                connections.forEach((connection, index) => {
                    htmlContent += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${connection.username}</td>
                            <td>${connection.ip_address}</td>
                            <td>${connection.date_time}</td>
                        </tr>
                    `;
                });
                htmlContent += '</tbody></table>';
                document.getElementById('contentSection').innerHTML = htmlContent;
            } catch (error) {
                console.error(error);
                document.getElementById('contentSection').innerHTML = `
                    <div class="alert alert-danger">Erreur lors de la récupération des connexions.</div>
                `;
            }
        }

        // Associer les boutons aux fonctions
        document.getElementById('showUsersBtn').addEventListener('click', fetchUsers);
        document.getElementById('showConnectionsBtn').addEventListener('click', fetchConnections);
    </script>
</body>
</html>
